# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –Ω–∞ VPS

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≤–µ—Ä—Å–∏–∏ 1.0 –¥–æ 2.0 (–∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏)

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

**–ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø!**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS
ssh zardes@dochealthgardenru

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /opt/hg-doc-storage

# 1. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec db pg_dump -U postgres contract_db > backup_before_v2_$(date +%Y%m%d_%H%M%S).sql

# 2. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø MinIO –¥–∞–Ω–Ω—ã—Ö
docker run --rm \
  -v hg-doc-storage_minio_data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/minio_backup_$(date +%Y%m%d_%H%M%S).tar.gz /data

# 3. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø .env —Ñ–∞–π–ª–∞
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

echo "‚úÖ –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞–Ω—ã"
ls -la backup_* .env.backup.*
```

### üîÑ –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# 2. –ü–æ–ª—É—á–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ Git
git pull origin main

# 3. –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
# –ó–∞–º–µ–Ω–∏—Ç–µ yourcompany.ru –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, doc.healthgarden.ru)
nano .env

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
# BASE_URL=https://doc.yourcompany.ru
# –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω:
# BASE_URL=https://doc.healthgarden.ru

# 4. –û–±–Ω–æ–≤–∏—Ç–µ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
nano nginx/nginx.conf

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
# server_name doc.yourcompany.ru;
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω:
# server_name doc.healthgarden.ru;

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./deploy.sh

# 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
docker-compose exec db psql -U postgres -d contract_db -c "\\d contracts" | grep short_id

# –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä–æ–∫—É —Å short_id
# –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç–µ - –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "Up"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check
curl http://localhost:8000/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å "healthy"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API –æ—Ç–≤–µ—á–∞–µ—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à API –∫–ª—é—á)
curl -H "Authorization: Bearer –í–ê–®_API_–ö–õ–Æ–ß" \
     http://localhost:8000/api/v1/status/test-uuid

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 404 (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, UUID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
# –ï—Å–ª–∏ 401 - –ø—Ä–æ–±–ª–µ–º–∞ —Å API –∫–ª—é—á–æ–º
# –ï—Å–ª–∏ 500 - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–≤–∏—Å–æ–º
```

### üß™ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

# 1. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º –∏ API –∫–ª—é—á–æ–º
nano test_short_links.sh

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
# API_BASE="${API_BASE:-https://doc.yourcompany.ru}"
# API_KEY="${API_KEY:-your-api-key-here}"

# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:
# API_BASE="${API_BASE:-https://doc.healthgarden.ru}"
# API_KEY="${API_KEY:-–≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-api-–∫–ª—é—á}"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
./test_short_links.sh
```

### üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω, –æ–±–Ω–æ–≤–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:

# 1. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot certonly --standalone -d doc.healthgarden.ru

# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç
sudo cp /etc/letsencrypt/live/doc.healthgarden.ru/fullchain.pem nginx/ssl/cert.pem
sudo cp /etc/letsencrypt/live/doc.healthgarden.ru/privkey.pem nginx/ssl/key.pem
sudo chown $USER:$USER nginx/ssl/*.pem

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
docker-compose restart nginx
```

### ‚ö†Ô∏è –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º - –æ—Ç–∫–∞—Ç –∫ –≤–µ—Ä—Å–∏–∏ 1.0

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –æ—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:

# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# 2. –û—Ç–∫–∞—Ç–∏—Ç–µ Git –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
git log --oneline -5  # –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
git checkout HEAD~1   # –û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –Ω–∞ 1 –∫–æ–º–º–∏—Ç –Ω–∞–∑–∞–¥

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ .env
cp .env.backup.–î–ê–¢–ê_–ë–≠–ö–ê–ü–ê .env

# 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d db
docker-compose exec -T db psql -U postgres -d contract_db < backup_before_v2_–î–ê–¢–ê.sql

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
./deploy.sh
```

### üéâ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –¥–ª—è 1–°:

1. **API –æ—Ç–≤–µ—Ç—ã —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏:**
```json
{
  "contract_id": "uuid-here",
  "short_id": "abc12345",
  "short_url": "https://doc.healthgarden.ru/abc12345"
}
```

2. **–ù–æ–≤—ã–π workflow —Å –æ–¥–Ω–æ–π —Å—Å—ã–ª–∫–æ–π:**
```
1–° –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª ‚Üí –ø–æ–ª—É—á–∞–µ—Ç short_url
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ short_url –∫–ª–∏–µ–Ω—Ç—É –≤ SMS
–ö–ª–∏–µ–Ω—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª –ø–æ —Å—Å—ã–ª–∫–µ
–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Ç–æ–π –∂–µ —Å—Å—ã–ª–∫–µ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é!
```

3. **–í—Å–µ —Å—Ç–∞—Ä—ã–µ API –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ —Å–ª–æ–º–∞—é—Ç—Å—è
- –ú–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
docker-compose logs -f app
```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
```bash
docker-compose restart app
```

3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é:**
- Telegram: —É–∫–∞–∂–∏—Ç–µ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Email: –ø—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–æ–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### üîç –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] Git –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] .env —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
- [ ] nginx.conf –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º  
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å (–µ—Å—Ç—å –ø–æ–ª–µ short_id)
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
- [ ] Health check –æ—Ç–≤–µ—á–∞–µ—Ç
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏! üöÄ**
